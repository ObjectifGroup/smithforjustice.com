<section id="contact" class="pb-lg-12 py-8 bg-light">
    <div class="container">
        <div class="row offset-md-1">
            <div class="col col-md-11">
                <div class="mb-8 text-center">
                    <h2 class="mb-3 h1">Contact</h2>
                    <p class="lead">Get involved with the campaign.</p>
                </div>
            </div>
        </div>
    </div>
    <div class="container">
        <div class="row offset-md-1">
            <div class="col col-md-11">
                <form method="POST" action="https://script.google.com/macros/s/AKfycbwxIy_Zk8Fj-0KagJop_JZ4Jgy0nrdcjBClJax4BG9C-JilkhFM0--w8hV7G5Zaj2zq/exec" id="contact-form2">
                    <!-- Required fields -->
                    <div class="row">

                        <!-- First Name -->
                        <div class="col-md-6 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="fname" placeholder="First Name" name="fname" required>
                                <label for="fname">First Name</label>
                            </div>
                        </div>

                        <!-- Last Name -->
                        <div class="col-md-6 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="lname" placeholder="Last Name" name="lname" required>
                                <label for="lname">Last Name</label>
                            </div>
                        </div>
                    </div>

                    <div class="row">
                        <!-- Email -->
                        <div class="col-12 mb-3">
                            <div class="form-floating">
                                <input type="email" class="form-control" id="email" placeholder="Email" name="email" required>
                                <label for="email">Email</label>
                            </div>
                        </div>
                    </div>

                    <!-- Toggle additional form fields for address -->
                    <div class="row">
                        <div class="col-12 mb-3">
                            <input class="form-check-input" type="checkbox" role="switch" id="addressSwitch" name="mailme"/>
                            <label class="form-check-label" for="addressSwitch">I'd like to receive mail by post</label>
                        </div>
                    </div>

                    <!-- Additional form fields for address -->
                    <div class="address-fields mb-3 row d-none">
                        <div class="col-md-6 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="address1" name="address1" placeholder="Address Line 1"/>
                                <label for="address1">Address Line 1</label>
                            </div>
                        </div>
                        <div class="col-md-6 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="address2" name="address2" placeholder="Address Line 2"/>
                                <label for="address2">Address Line 2</label>
                            </div>
                        </div>
                        <div class="col-md-4 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="city" name="city" placeholder="City"/>
                                <label for="city">City</label>
                            </div>
                        </div>
                        <div class="col-md-4 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="state" name="state" placeholder="State"/>
                                <label for="state">State</label>
                            </div>
                        </div>
                        <div class="col-md-4 col-12 mb-3">
                            <div class="form-floating">
                                <input type="text" class="form-control" id="postalcode" name="postalcode" placeholder="Postal Code"/>
                                <label for="postalcode">Postal Code</label>
                            </div>
                        </div>
                    </div>

                    <!-- Purpose selector -->
                    <div class="mb-3 col-12 mb-3">
                        <div class="form-floating">
                            <select class="form-select" id="purpose" name="purpose">
                                <option selected="">Why are you contacting the campaign?</option>
                                <option value="I want to volunteer">I want to volunteer</option>
                                <option value="I want to invite you to speak at or attend an event">I want to invite you to speak at or attend an event</option>
                                <option value="I'd like to be kept up to date with the campaign">I'd like to be kept up to date with the campaign</option>
                                <option value="I have general questions about the camapign">I have general questions about the camapign</option>
                            </select>
                            <label for="purpose">Select one</label>
                        </div>
                    </div>

                    <!-- Math Captcha -->
                    <div class="row">
                        <div class="col-12 mb-3">
                            <div class="input-group has-validation">
                                <span class="input-group-text" id="math-captcha2"></span>
                                <div class="form-floating">
                                    <input type="text" class="form-control" id="captcha-solution2" placeholder="Solve the equation" required>
                                    <label for="captcha-solution2">Captcha</label>
                                </div>
                                <div class="invalid-feedback">
                                    Please solve the math problem correctly.
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Submit Button with Spinner -->
                    <div class="col-12">
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary" id="submit-button2">
                                Send Message
                                <span id="submit-spinner2" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                            </button>
                        </div>
                    </div>
                </form>

                <!-- Success alert -->
                <div class="alert alert-success mt-3" id="success-alert2" style="display: none;">
                    <strong>Success!</strong> Your message has been sent.
                </div>

            </div>
        </div>
    </div>
</section>

<script>
    // reveal address inputs
    $(document).ready(function () {
        const addressSwitch = document.getElementById("addressSwitch");
        const addressFields = document.querySelector(".address-fields");

        addressSwitch.addEventListener("change", function () {
            if (addressSwitch.checked) {
                addressFields
                    .classList
                    .remove("d-none");
            } else {
                addressFields
                    .classList
                    .add("d-none");
            }
        });
    });

    function generateMathCaptcha2() {
        const num1 = Math.floor(Math.random() * 10) + 1; // numbers 1-10
        const num2 = Math.floor(Math.random() * 10) + 1; // numbers 1-10
        const sum = num1 + num2;

        const captchaText = document.getElementById('math-captcha2');
        captchaText.textContent = `${num1} + ${num2} = ?`;

        return sum;
    }

    window.addEventListener("load", function () {
        let correctAnswer = generateMathCaptcha2();
        const form = document.getElementById('contact-form2');
        const captchaSolution = document.getElementById('captcha-solution2');
        const submitSpinner = document.getElementById('submit-spinner2');
        const successAlert = document.getElementById('success-alert2');

        form.addEventListener("submit", function (e) {
            e.preventDefault();

            // Validate CAPTCHA
            if (parseInt(captchaSolution.value) !== correctAnswer) {
                captchaSolution
                    .classList
                    .add('is-invalid');
            } else {
                captchaSolution
                    .classList
                    .remove('is-invalid');
                submitSpinner
                    .classList
                    .remove('d-none'); // Show spinner

                // Perform the form submission
                const data = new FormData(form);
                const action = form.getAttribute('action');

                fetch(action, {
                    method: 'POST',
                    body: data
                })
                    .then(response => response.json())
                    .then(data => {
                        submitSpinner
                            .classList
                            .add('d-none'); // Hide spinner
                        if (data.result === "success") {
                            // Show success message
                            successAlert.style.display = 'block';
                            // Reset form
                            form.reset();
                            // Optionally hide the success message after a delay
                            setTimeout(() => {
                                successAlert.style.display = 'none';
                            }, 5000);
                        } else {
                            // Handle server-side validation errors
                            // You can add more specific error handling here
                        }
                    })
                    .catch(error => {
                        submitSpinner
                            .classList
                            .add('d-none'); // Hide spinner
                        // Handle network error
                    });
            }
        });

        // Regenerate captcha when clicked
        captchaSolution.addEventListener("click", function () {
            correctAnswer = generateMathCaptcha2();
        });
    });
</script>